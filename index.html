<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LoL ë‚´ì „ íˆ¬í‘œ - Firebase ë²„ì „</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .time-grid { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
    .checkbox-cell { padding: 10px; border: 1px solid #ccc; min-width: 80px; cursor: pointer; }
    .checkbox-cell input { transform: scale(1.2); }
    .user-list button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 14px;
    }
    .selected-user { font-weight: bold; color: green; }
  </style>
</head>
<body>
  <h1>LoL ë‚´ì „ ì‹œê°„ëŒ€ íˆ¬í‘œ</h1>
  <p>ì´ë¦„ì„ ì„ íƒí•˜ê³  ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ë¥¼ ì²´í¬í•˜ì„¸ìš”:</p>

  <div class="user-list" id="userList"></div>
  <div><strong>ì„ íƒëœ ì‚¬ëŒ:</strong> <span id="currentUser" class="selected-user">ì—†ìŒ</span></div>

  <div class="time-grid" id="timeGrid"></div>

  <button onclick="submitAvailability()">ì €ì¥í•˜ê¸°</button>
  <button onclick="clearAvailability()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  <button onclick="showResults()">ê²°ê³¼ ë³´ê¸°</button>

  <h2>ëª¨ë“  ê²°ê³¼:</h2>
<!-- ğŸ§¨ ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ -->
<div style="margin-top: 20px; text-align: center;">
  <button style="background-color: #dc3545;" onclick="resetAllData()">ğŸ§¨ ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button>
</div>

  <pre id="results"></pre>

  <script>
    // âœ… [ì—¬ê¸°ì— Firebase ì„¤ì • ë¶™ì—¬ë„£ê¸°]
    const firebaseConfig = {
        apiKey: "AIzaSyA72WFh7CDmLKLUMoR2Ws1H-IH612aS4jE",
        authDomain: "lol-vote-f9dd0.firebaseapp.com",
        projectId: "lol-vote-f9dd0",
        storageBucket: "lol-vote-f9dd0.firebasestorage.app",
        messagingSenderId: "43337092856",
        appId: "1:43337092856:web:b8784d8015c192df83350d",
        measurementId: "G-4D9S9JGLSH"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ì°¸ê°€ì ëª©ë¡ê³¼ ì‹œê°„ëŒ€
    const users = ["ì¤€ì˜", "ë¯¼ì„­", "ì§„ê´€", "ì¤€í˜¸", "íœ˜ê·¼", "ì—¬ì¤€", "ì¬í™˜", "ê²½í•™", "ì£¼í˜„", "íœ˜ì¤€", "ì›ìš©", "ì¬ì°½", "ì˜ì¤€", "ê·¼ë¡", "íƒœí˜„", "ì¬í˜"];
    const hours = ["18", "19", "20", "21", "22", "23"];
    let selectedUser = null;

    const userListDiv = document.getElementById("userList");
    const timeGrid = document.getElementById("timeGrid");
    const currentUserSpan = document.getElementById("currentUser");

    // ì‚¬ìš©ì ë²„íŠ¼ ë§Œë“¤ê¸°
    users.forEach(name => {
      const btn = document.createElement("button");
      btn.textContent = name;
      btn.onclick = () => selectUser(name);
      userListDiv.appendChild(btn);
    });

    function createGrid() {
      timeGrid.innerHTML = "";
      hours.forEach(hour => {
        const cell = document.createElement("div");
        cell.className = "checkbox-cell";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `hour-${hour}`;
        cell.appendChild(checkbox);
        cell.appendChild(document.createTextNode(` ${hour}ì‹œ`));
        timeGrid.appendChild(cell);
      });
    }

    createGrid();

    function selectUser(name) {
      selectedUser = name;
      currentUserSpan.textContent = name;
      loadAvailability();
    }

    async function loadAvailability() {
      if (!selectedUser) return;
      const doc = await db.collection("votes").doc(selectedUser).get();
      const data = doc.exists ? doc.data() : {};

      hours.forEach(hour => {
        const id = `hour-${hour}`;
        document.getElementById(id).checked = data[hour] || false;
      });
    }

    async function submitAvailability() {
      if (!selectedUser) {
        alert("ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”.");
        return;
      }

      const availability = {};
      hours.forEach(hour => {
        const id = `hour-${hour}`;
        availability[hour] = document.getElementById(id).checked;
      });

      await db.collection("votes").doc(selectedUser).set(availability);
      alert(`${selectedUser}ë‹˜ì˜ ì‹œê°„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
    async function clearAvailability() {
      if (!selectedUser) {
        alert("ì‚¬ìš©ìë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");
        return;
      }

      const confirmed = confirm(`${selectedUser}ë‹˜ì˜ ì‹œê°„ëŒ€ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
      if (!confirmed) return;

      await db.collection("votes").doc(selectedUser).delete();

      // ì²´í¬ë°•ìŠ¤ ì „ë¶€ í•´ì œ
      hours.forEach(hour => {
        document.getElementById(`hour-${hour}`).checked = false;
      });

      alert(`${selectedUser}ë‹˜ì˜ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    async function resetAllData() {
  const confirmed = confirm("âš ï¸ ëª¨ë“  ì°¸ê°€ìì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
  if (!confirmed) return;

  const snapshot = await db.collection("votes").get();
  const batch = db.batch();

  snapshot.forEach(doc => {
    batch.delete(doc.ref);
  });

  await batch.commit();
  alert("ì „ì²´ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
  document.getElementById("results").textContent = "";
}


    async function showResults() {
  const snapshot = await db.collection("votes").get();
  const votesByHour = {}; // ì‹œê°„ë³„ë¡œ ì´ë¦„ ëª©ë¡ ì €ì¥

  snapshot.forEach(doc => {
    const name = doc.id;
    const data = doc.data();
    for (const hour in data) {
      if (data[hour]) {
        if (!votesByHour[hour]) votesByHour[hour] = [];
        votesByHour[hour].push(name);
      }
    }
  });

  const sorted = Object.entries(votesByHour).sort((a, b) => b[1].length - a[1].length);
  let resultText = "";

  sorted.forEach(([hour, names]) => {
    resultText += `${hour}ì‹œ: ${names.length}ëª… (${names.join(", ")})\n`;
  });

  document.getElementById("results").textContent = resultText || "ì•„ì§ ë°ì´í„° ì—†ìŒ.";
}

  </script>
</body>
</html>
