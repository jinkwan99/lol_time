<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LoL 내전 투표 - Firebase 버전</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .time-grid { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
    .checkbox-cell { padding: 10px; border: 1px solid #ccc; min-width: 80px; cursor: pointer; }
    .checkbox-cell input { transform: scale(1.2); }
    .user-list button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 14px;
    }
    .selected-user { font-weight: bold; color: green; }
  </style>
</head>
<body>
  <h1>LoL 내전 시간대 투표</h1>
  <p>이름을 선택하고 가능한 시간대를 체크하세요:</p>

  <div class="user-list" id="userList"></div>
  <div><strong>선택된 사람:</strong> <span id="currentUser" class="selected-user">없음</span></div>

  <div class="time-grid" id="timeGrid"></div>

  <button onclick="submitAvailability()">저장하기</button>
  <button onclick="showResults()">결과 보기</button>

  <h2>모든 결과:</h2>
  <pre id="results"></pre>

  <script>
    // ✅ [여기에 Firebase 설정 붙여넣기]
    const firebaseConfig = {
        apiKey: "AIzaSyA72WFh7CDmLKLUMoR2Ws1H-IH612aS4jE",
        authDomain: "lol-vote-f9dd0.firebaseapp.com",
        projectId: "lol-vote-f9dd0",
        storageBucket: "lol-vote-f9dd0.firebasestorage.app",
        messagingSenderId: "43337092856",
        appId: "1:43337092856:web:b8784d8015c192df83350d",
        measurementId: "G-4D9S9JGLSH"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 참가자 목록과 시간대
    const users = ["철수", "영희", "민수", "지수"];
    const hours = ["18", "19", "20", "21", "22", "23"];
    let selectedUser = null;

    const userListDiv = document.getElementById("userList");
    const timeGrid = document.getElementById("timeGrid");
    const currentUserSpan = document.getElementById("currentUser");

    // 사용자 버튼 만들기
    users.forEach(name => {
      const btn = document.createElement("button");
      btn.textContent = name;
      btn.onclick = () => selectUser(name);
      userListDiv.appendChild(btn);
    });

    function createGrid() {
      timeGrid.innerHTML = "";
      hours.forEach(hour => {
        const cell = document.createElement("div");
        cell.className = "checkbox-cell";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `hour-${hour}`;
        cell.appendChild(checkbox);
        cell.appendChild(document.createTextNode(` ${hour}시`));
        timeGrid.appendChild(cell);
      });
    }

    createGrid();

    function selectUser(name) {
      selectedUser = name;
      currentUserSpan.textContent = name;
      loadAvailability();
    }

    async function loadAvailability() {
      if (!selectedUser) return;
      const doc = await db.collection("votes").doc(selectedUser).get();
      const data = doc.exists ? doc.data() : {};

      hours.forEach(hour => {
        const id = `hour-${hour}`;
        document.getElementById(id).checked = data[hour] || false;
      });
    }

    async function submitAvailability() {
      if (!selectedUser) {
        alert("이름을 선택하세요.");
        return;
      }

      const availability = {};
      hours.forEach(hour => {
        const id = `hour-${hour}`;
        availability[hour] = document.getElementById(id).checked;
      });

      await db.collection("votes").doc(selectedUser).set(availability);
      alert(`${selectedUser}님의 시간이 저장되었습니다.`);
    }

    async function showResults() {
      const snapshot = await db.collection("votes").get();
      const counts = {};

      snapshot.forEach(doc => {
        const data = doc.data();
        for (const hour in data) {
          if (data[hour]) {
            counts[hour] = (counts[hour] || 0) + 1;
          }
        }
      });

      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
      let resultText = "";
      sorted.forEach(([hour, count]) => {
        resultText += `${hour}시: ${count}명\n`;
      });

      document.getElementById("results").textContent = resultText || "아직 데이터 없음.";
    }
  </script>
</body>
</html>
